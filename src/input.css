@import "tailwindcss";
@plugin "@tailwindcss/typography";

@custom-variant dark {
    &:where(.dark *),
    &:where([data-theme="dark"] *) {
        @slot;
    }
}

@custom-variant paper {
    &:where([data-theme="paper"] *) {
        @slot;
    }
}

/* Add paragraph spacing styles */
.whitespace-pre-line {
    white-space: pre-line;
}

.whitespace-pre-line br {
    content: "";
    display: block;
    margin-bottom: 1.5em;
}

li {
    text-indent: 0;
    margin-left: 20px;
}

@media (min-width: 768px) {
    li {
        margin-left: 80px;
    }
}

:where(.dark) body,
:where([data-theme="dark"]) body {
    --tw-bg-opacity: 1;
    background-color: rgb(0 0 0 / var(--tw-bg-opacity));
}

@layer base {
    [data-theme="paper"] {
        background-color: #fdf6e3;
        color: #1f2937;
        --paper-texture: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 240 240'><filter id='paper-texture'><feTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' seed='5' stitchTiles='stitch' result='noise'/><feColorMatrix in='noise' type='matrix' values='1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 0.28 0'/></filter><rect width='100%' height='100%' filter='url(#paper-texture)' opacity='0.42'/></svg>");
        --paper-fiber-overlay: radial-gradient(160px 180px at 18% 28%, rgba(114, 94, 66, 0.05), transparent 60%),
            radial-gradient(180px 160px at 76% 74%, rgba(114, 94, 66, 0.045), transparent 62%);
        --paper-pencil-filter: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2 2'><filter id='pencil-texture' x='-8%' y='-8%' width='116%' height='116%'><feTurbulence type='fractalNoise' baseFrequency='0.48' numOctaves='2' seed='9' result='noise'/><feColorMatrix in='noise' type='matrix' values='1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 0.32 0' result='grain'/><feComposite in='grain' in2='SourceAlpha' operator='in' result='maskedGrain'/><feBlend in='SourceGraphic' in2='maskedGrain' mode='multiply'/></filter></svg>#pencil-texture");
    }

    [data-theme="paper"] body {
        background-color: #fdf6e3;
        color: #1f2937;
        background-image:
            radial-gradient(1200px at 30% 18%, rgba(255, 255, 255, 0.6), rgba(253, 246, 227, 0)),
            radial-gradient(900px at 82% 8%, rgba(255, 255, 255, 0.38), rgba(253, 246, 227, 0)),
            linear-gradient(
                160deg,
                rgba(236, 221, 193, 0.32) 0%,
                rgba(236, 221, 193, 0.14) 32%,
                rgba(217, 197, 158, 0.08) 100%
            ),
            var(--paper-texture),
            var(--paper-fiber-overlay);
        background-size: 100% 100%, 100% 100%, 100% 100%, 420px 420px, 340px 340px;
        background-blend-mode: screen, soft-light, multiply, normal, multiply;
        box-shadow: inset 0 0 48px rgba(17, 24, 39, 0.05);
    }

    [data-theme="paper"] :where(
        p,
        span,
        a,
        li,
        strong,
        em,
        small,
        code,
        pre,
        blockquote,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        button,
        label,
        input,
        textarea
    ) {
        filter: var(--paper-pencil-filter);
    }

    [data-theme="paper"] .prose,
    [data-theme="paper"] .paper\:prose {
        --tw-prose-body: #1f2937;
        --tw-prose-headings: #111827;
        --tw-prose-links: #111827;
        --tw-prose-bold: #111827;
        --tw-prose-counters: #4b5563;
        --tw-prose-bullets: #4b5563;
        --tw-prose-hr: #e4d5b2;
        --tw-prose-quotes: #1f2937;
        --tw-prose-quote-borders: #d4c29a;
        --tw-prose-captions: #4b5563;
        --tw-prose-code: #111827;
        --tw-prose-pre-code: #111827;
        --tw-prose-pre-bg: #f0e6cf;
    }

    [data-theme="paper"] button,
    [data-theme="paper"] button:hover,
    [data-theme="paper"] button:focus {
        background-color: transparent !important;
        color: #111827 !important;
    }
}

@layer utilities {
    @keyframes toast-in {
        from {
            opacity: 0;
            transform: translateY(32px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes toast-out {
        from {
            opacity: 1;
            transform: translateY(0);
        }

        to {
            opacity: 0;
            transform: translateY(-32px);
        }
    }

    .toast-animate-in {
        animation: toast-in 0.4s cubic-bezier(0.4, 0, 0.2, 1) both;
        will-change: opacity, transform;
    }

    .toast-animate-out {
        animation: toast-out 0.4s cubic-bezier(0.4, 0, 0.2, 1) both;
        will-change: opacity, transform;
    }

    @keyframes fadein-choices {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    .animate-fadein-choices {
        animation: fadein-choices 1s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        will-change: opacity, transform;
    }
}

@layer components {
    .journal-page {
        @apply relative mx-auto max-w-2xl p-10 rounded-lg shadow-lg bg-[#f9f6ee]
               bg-[radial-gradient(rgba(0,0,0,0.04)_1px,transparent_1px),radial-gradient(rgba(0,0,0,0.03)_1px,transparent_1px)]
               bg-[length:3px_3px,6px_6px] text-stone-700;
    }

    .journal-page::before {
        content: "";
        @apply absolute top-6 bottom-6 left-8 w-px bg-red-400 opacity-80;
    }

    .journal-lines {
        @apply relative pl-10 pr-3 py-2;
        background-image: linear-gradient(to bottom, rgba(120,110,90,0.18) 1px, transparent 1px);
        background-size: 100% 1.8rem;
    }

    .journal-choice {
        @apply flex items-center gap-2 px-4 py-2 rounded-full cursor-pointer
               bg-white/70 shadow-sm hover:shadow-md hover:bg-white transition;
    }

    .journal-choice-index {
        @apply font-semibold text-sm text-orange-700;
    }

    /* 深色模式 */
    .dark .journal-page {
        @apply bg-[#26231f] text-[#f1e8d8];
        background-image: radial-gradient(rgba(255,255,255,0.04)_1px,transparent_1px),
                           radial-gradient(rgba(255,255,255,0.03)_1px,transparent_1px);
        background-size: 3px 3px, 6px 6px;
    }

    .dark .journal-lines {
        background-image: linear-gradient(to bottom, rgba(255,255,255,0.18) 1px, transparent 1px);
    }

    .dark .journal-choice {
        @apply bg-neutral-800/80 text-[#f3e9db];
    }
}
