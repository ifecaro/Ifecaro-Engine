@import "tailwindcss";
@plugin "@tailwindcss/typography";

@custom-variant dark {
    &:where(.dark *),
    &:where([data-theme="dark"] *) {
        @slot;
    }
}

@custom-variant paper {
    &:where([data-theme="paper"] *) {
        @slot;
    }
}

/* Add paragraph spacing styles */
.whitespace-pre-line {
    white-space: pre-line;
}

.whitespace-pre-line br {
    content: "";
    display: block;
    margin-bottom: 1.5em;
}

li {
    text-indent: 0;
    margin-left: 20px;
}

@media (min-width: 768px) {
    li {
        margin-left: 80px;
    }
}

:where(.dark) body,
:where([data-theme="dark"]) body {
    --tw-bg-opacity: 1;
    background-color: rgb(0 0 0 / var(--tw-bg-opacity));
}

@layer base {
    [data-theme="paper"] {
        --paper-text-opacity: 80%;
        background-color: #fdf6e3;
        color: color-mix(in srgb, #1f2937 var(--paper-text-opacity), transparent);
        --paper-texture: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0MDAgNDAwIj4KICA8ZmlsdGVyIGlkPSJyb3VnaHBhcGVyIiB4PSIwJSIgeT0iMCUiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiPgogICAgPGZlVHVyYnVsZW5jZSB0eXBlPSJmcmFjdGFsTm9pc2UiIGJhc2VGcmVxdWVuY3k9IjAuMTI1IDAuMTc1IiByZXN1bHQ9Im5vaXNlIiBudW1PY3RhdmVzPSIzIiBzZWVkPSIyMDAwMCIgLz4KICAgIDxmZURpZmZ1c2VMaWdodGluZyBpbj0ibm9pc2UiIHN1cmZhY2VTY2FsZT0iMC42NSI+CiAgICAgIDxmZURpc3RhbnRMaWdodCBhemltdXRoPSI5MCIgZWxldmF0aW9uPSI2NSIgLz4KICAgIDwvZmVEaWZmdXNlTGlnaHRpbmc+CiAgPC9maWx0ZXI+CiAgPHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsdGVyPSJ1cmwoI3JvdWdocGFwZXIpIiBvcGFjaXR5PSIwLjkiIC8+Cjwvc3ZnPgo=");
    }

    [data-theme="paper"] body {
        background-color: #fdf6e3;
        color: color-mix(in srgb, #1f2937 var(--paper-text-opacity), transparent);
        background-image:
            radial-gradient(1200px at 30% 18%, rgba(255, 255, 255, 0.6), rgba(253, 246, 227, 0)),
            radial-gradient(900px at 82% 8%, rgba(255, 255, 255, 0.38), rgba(253, 246, 227, 0)),
            linear-gradient(
                160deg,
                rgba(236, 221, 193, 0.32) 0%,
                rgba(236, 221, 193, 0.14) 32%,
                rgba(217, 197, 158, 0.08) 100%
            ),
            var(--paper-texture);
        background-size: 100% 100%, 100% 100%, 100% 100%, 420px 420px;
        background-blend-mode: screen, soft-light, multiply, normal;
        box-shadow: inset 0 0 48px rgba(17, 24, 39, 0.05);
    }

    [data-theme="paper"] :is(
        p,
        span,
        li,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        a,
        button,
        label,
        small,
        strong,
        em,
        code,
        blockquote,
        input,
        textarea,
        select,
        option
    ) {
        color: color-mix(in srgb, currentColor var(--paper-text-opacity), transparent);
    }

    [data-theme="paper"] .prose,
    [data-theme="paper"] .paper\:prose {
        --tw-prose-body: color-mix(in srgb, #1f2937 var(--paper-text-opacity), transparent);
        --tw-prose-headings: color-mix(in srgb, #111827 var(--paper-text-opacity), transparent);
        --tw-prose-links: color-mix(in srgb, #111827 var(--paper-text-opacity), transparent);
        --tw-prose-bold: color-mix(in srgb, #111827 var(--paper-text-opacity), transparent);
        --tw-prose-counters: color-mix(in srgb, #4b5563 var(--paper-text-opacity), transparent);
        --tw-prose-bullets: color-mix(in srgb, #4b5563 var(--paper-text-opacity), transparent);
        --tw-prose-hr: #e4d5b2;
        --tw-prose-quotes: color-mix(in srgb, #1f2937 var(--paper-text-opacity), transparent);
        --tw-prose-quote-borders: #d4c29a;
        --tw-prose-captions: color-mix(in srgb, #4b5563 var(--paper-text-opacity), transparent);
        --tw-prose-code: color-mix(in srgb, #111827 var(--paper-text-opacity), transparent);
        --tw-prose-pre-code: color-mix(in srgb, #111827 var(--paper-text-opacity), transparent);
        --tw-prose-pre-bg: #f0e6cf;
    }

    [data-theme="paper"] button,
    [data-theme="paper"] button:hover,
    [data-theme="paper"] button:focus {
        background-color: transparent !important;
        color: #111827 !important;
    }
}

@layer utilities {
    @keyframes toast-in {
        from {
            opacity: 0;
            transform: translateY(32px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes toast-out {
        from {
            opacity: 1;
            transform: translateY(0);
        }

        to {
            opacity: 0;
            transform: translateY(-32px);
        }
    }

    .toast-animate-in {
        animation: toast-in 0.4s cubic-bezier(0.4, 0, 0.2, 1) both;
        will-change: opacity, transform;
    }

    .toast-animate-out {
        animation: toast-out 0.4s cubic-bezier(0.4, 0, 0.2, 1) both;
        will-change: opacity, transform;
    }

    @keyframes fadein-choices {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    .animate-fadein-choices {
        animation: fadein-choices 1s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        will-change: opacity, transform;
    }

    :where([data-theme="paper"]) {
        --story-paragraph-filter: url(#pen-texture);
    }

    :where([data-theme="paper"] .pen-texture-text),
    :where([data-theme="paper"] .pen-texture-text *),
    :where([data-theme="paper"] .pen-texture-text::marker) {
        -webkit-filter: var(--story-paragraph-filter, none);
        filter: var(--story-paragraph-filter, none);
    }

    .story-text-filter {
        -webkit-filter: var(--story-paragraph-filter, none);
        filter: var(--story-paragraph-filter, none);
    }
}

@layer components {
    :where([data-theme="paper"] .paper-surface) {
        background-color: #fdf6e3;
        background-image:
            radial-gradient(1200px at 30% 18%, rgba(255, 255, 255, 0.6), rgba(253, 246, 227, 0)),
            radial-gradient(900px at 82% 8%, rgba(255, 255, 255, 0.38), rgba(253, 246, 227, 0)),
            linear-gradient(
                160deg,
                rgba(236, 221, 193, 0.32) 0%,
                rgba(236, 221, 193, 0.14) 32%,
                rgba(217, 197, 158, 0.08) 100%
            ),
            var(--paper-texture);
        background-size: 100% 100%, 100% 100%, 100% 100%, 420px 420px;
        background-blend-mode: screen, soft-light, multiply, normal;
        box-shadow: inset 0 0 48px rgba(17, 24, 39, 0.05);
    }

    .journal-page {
        @apply relative mx-auto max-w-2xl p-10 rounded-lg shadow-lg bg-[#f9f6ee]
               bg-[radial-gradient(rgba(0,0,0,0.04)_1px,transparent_1px),radial-gradient(rgba(0,0,0,0.03)_1px,transparent_1px)]
               bg-[length:3px_3px,6px_6px] text-stone-700;
    }

    .journal-page::before {
        content: "";
        @apply absolute top-6 bottom-6 left-8 w-px bg-red-400 opacity-80;
    }

    .journal-lines {
        @apply relative pl-10 pr-3 py-2;
        background-image: linear-gradient(to bottom, rgba(120,110,90,0.18) 1px, transparent 1px);
        background-size: 100% 1.8rem;
    }

    .journal-choice {
        @apply flex items-center gap-2 px-4 py-2 rounded-full cursor-pointer
               bg-white/70 shadow-sm hover:shadow-md hover:bg-white transition;
    }

    .journal-choice-index {
        @apply font-semibold text-sm text-orange-700;
    }

    /* 深色模式 */
    .dark .journal-page {
        @apply bg-[#26231f] text-[#f1e8d8];
        background-image: radial-gradient(rgba(255,255,255,0.04)_1px,transparent_1px),
                           radial-gradient(rgba(255,255,255,0.03)_1px,transparent_1px);
        background-size: 3px 3px, 6px 6px;
    }

    .dark .journal-lines {
        background-image: linear-gradient(to bottom, rgba(255,255,255,0.18) 1px, transparent 1px);
    }

    .dark .journal-choice {
        @apply bg-neutral-800/80 text-[#f3e9db];
    }
}
